# AI Teams - 開発状況まとめ (2025-12-31)

## 📊 現状

### ✅ 完成したもの
1. **ai_council.py** (旧版 - 動作確認済み)
   - 討論番組スタイルのAI討論
   - 司会者を「知的な女性キャスター」に変更
   - フェーズ管理（Opening → Divergence → Convergence → Conclusion）
   - 最新AIモデル使用（Gemini 3, GPT-4o, Claude Sonnet 4）
   - ポート8501で起動中

### 🚧 開発中のもの
2. **app.py** (新版 - データ永続化版)
   - SQLiteによるデータ永続化
   - APIキーの自動保存
   - ルーム機能（会議履歴）
   - エージェント管理UI
   - ポート8502で起動中
   - **問題**: 討論ロジックが正しく動作していない

## 🔧 実装済み機能

### データベース層 (`database.py`)
- ✅ SQLite3によるデータ管理
- ✅ 設定テーブル（APIキー保存）
- ✅ エージェントテーブル（CRUD）
- ✅ ルームテーブル（会議管理）
- ✅ メッセージテーブル（会話履歴）

### LLMクライアント (`llm_client.py`)
- ✅ OpenAI, Google, Anthropic の統一インターフェース
- ✅ ストリーミング対応（準備済み）

### UI/UX
- ✅ Slack/Teamsライクなデザイン
- ✅ メッセージバブル（白色テキスト）
- ✅ エージェント管理画面
- ✅ API設定画面
- ✅ 新規会議作成フォーム

## ❌ 未解決の問題

### app.pyの討論ロジック
- メッセージがDBに保存されるが、画面に表示されない
- 「完了しました」と表示されるが、途中経過が見えない
- 原因: `st.rerun()`のタイミングまたはメッセージ取得ロジックの問題

## 💡 推奨される対応

### オプション1: 旧版を改善（推奨）
`ai_council.py`をベースに、以下を追加:
- APIキーの永続化（簡易版）
- 会話履歴のエクスポート機能
- メッセージのコピー機能

### オプション2: 新版をデバッグ
`app.py`の討論ロジックを修正:
- メッセージ表示タイミングの見直し
- `st.rerun()`の使い方を変更
- 旧版のロジックを完全移植

## 📁 ファイル一覧

```
雑談部屋/
├── ai_council.py          # 旧版（動作OK）
├── app.py                 # 新版（開発中）
├── database.py            # DB管理
├── llm_client.py          # LLM統一クライアント
├── requirements.txt       # 依存パッケージ
├── API_KEY.txt           # APIキー（手動管理）
├── ai_teams.db           # SQLiteデータベース
├── README.md             # 旧版README
└── README_AI_TEAMS.md    # 新版README
```

## 🎯 次のステップ

1. **短期**: `ai_council.py`を使い続ける（安定版）
2. **中期**: `app.py`の討論ロジックをデバッグ
3. **長期**: ストリーミング表示、コスト計算、マルチモーダル対応

---

**作成日**: 2025-12-31 20:57  
**ステータス**: Phase 1 完了、Phase 2 デバッグ中
